{% extends 'base.html' %}

{% block content %}
{% set status_class = {
    'Open': 'badge-open',
    'In Progress': 'badge-progress',
    'Resolved': 'badge-resolved',
    'Closed': 'badge-closed'
}[ticket[5]] %}

<h3>Ticket #{{ ticket[0] }} â€“ {{ ticket[2] }}</h3>
<p><strong>Category:</strong> {{ ticket[4] }}</p>
<p><strong>Status:</strong>
    <span class="badge {{ status_class }}">{{ ticket[5] }}</span>
</p>
<p><strong>Description:</strong><br>{{ ticket[3] }}</p>

{% if session.role == 'agent' %}
    <form method="POST" class="my-2">
        <input type="hidden" name="action" value="update_status">
        <div class="btn-group mb-3" role="group">
            <button name="status" value="In Progress" class="btn btn-warning btn-sm">Mark In Progress</button>
            <button name="status" value="Resolved" class="btn btn-success btn-sm">Mark Resolved</button>
            <button name="status" value="Closed" class="btn btn-danger btn-sm">Mark Closed</button>
        </div>
    </form>
{% endif %}

<hr>

<h5>Conversation:</h5>
{% if comments %}
    {% for msg in comments %}
        <div class="border p-2 mb-2">
            <strong>{{ msg[1] }}</strong> <small class="text-muted">({{ msg[2] }})</small><br>
            {{ msg[0] }}
        </div>
    {% endfor %}
{% else %}
    <p class="text-muted">No comments yet.</p>
{% endif %}

<form method="POST" class="mt-3">
    <div class="mb-3">
        <textarea name="message" class="form-control" placeholder="Add a comment..." rows="3" required></textarea>
    </div>
    <button class="btn btn-primary">Reply</button>
</form>
{% endblock %}
